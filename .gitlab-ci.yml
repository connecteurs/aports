stages:
  - build

pages:
  stage: build
  image:
    name: registry.gitlab.com/les-connecteurs/docker/alpine-buildrepo
    entrypoint: [""]
  script:
    - cd /home/builder
    - sudo cp -r "$CI_PROJECT_DIR" aports
    - sudo chown -R builder:builder aports
    - sudo -u builder ./entrypoint.sh main
    - chmod +x aports/directory_index.sh
    - aports/directory_index.sh packages
    - mv packages "$CI_PROJECT_DIR/public"
  artifacts:
    paths:
      - public
  only:
    - master
